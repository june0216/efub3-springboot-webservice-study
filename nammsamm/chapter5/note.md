# Chap.5



### Spring Security

: 막각한 인증(Authentication)과 인가(Authorization) 기능을 가진 프레임워크.

- 스프링 기반의 애플리케이션에서는 보안을 위한 표준으로 기능.
- 권장하는 방식.

### 소셜 로그인

- 로그인 기능에서 id/password 방식을 이용하는 경우보다 소셜 로그인 기능을 이용하는 경우가 많다.
- 장점 : id/password에서 구현해야 하는 것을 구글이나 네이버 등에 맞길 수 있다.
  1. 로그인 시 보안
  2. 이메일/전화번호 인증
  3. 비밀번호 찾기
  4. 비밀번호 변경
  5. 회원 정보 변경

ex) 구글 서비스 등록

- 애플리케이션 이름: 구글 로그인 시 사용자에게 노출될 애플리케이션 이름
- 지원 이메일 : 사용자 등의 화면에서 노출될 이메일 주소.
- Google API 범위 : 구글 서비스에서 사용할 범위 목록.
  - 기본값 : email/profile/openid

### 클래스에 직렬화를 구현해야 하는가?

- 엔티티 클래스의 경우 다른 엔티티와 관계를 맺는 경우 많음.
  
  이 경우 그런 엔티티들까지 직렬화 대상에 포함됨 → 성능 이슈, 부수 효과 발생 가능.
  
- **엔티티 클래스에 직렬화를 구현하는 것보다는 직렬화 기능을 가진 세션 Dto를 추가하기**.
  

### 세션 저장소로 데이터베이스 사용하기

- 내장 톰캣을 메모리에 저장 → 애플리케이션 실행 시 실행되는 구조에선 항상 초기화.
  - 배포할 때마다 톰캣이 재시작하는 것.

→ 세션 저장소 이용

1. 톰캣 세션 사용
  - 기본적으로 선택되는 방식.
  - 톰캣 간의 세션 공유를 위한 추가 설정 필요.
2. MySQL 등 다른 데이터베이스를 세션 저장소로 이용.
  - 여러 WAS 간 고용 세션 사용이 가능한 가장 쉬운 방법.
  - 성능 이슈 발생 가능성이 있다.
  - 로그인 요청이 많이 없는 백오피스, 서버 시스템 용도로 많이 이용된다.
3. Redis,Memcached 등 메모리 DB를 세션 저장소로 이용
  - B2C 서비스에 가장 많이 사용된다.
  - 외부 메모리 서버가 필요하다.

### 실습

- `@Enumerated(EnumType.STRING)` : JPA로 데이터베이스에 저장할 떄 enum 값을 어떤 형태로 저장할 지 결정
  - 기본은 int형 숫자 → 데이터베이스로 확인할 때 그 값이 무슨 코드를 의미하는 지 알 수 없다.
- 스프링 시큐리티에서는 권한 코드에 항상 `ROLE_` 이 앞에 있어야만 한다.
- `spring-boot-starter-oauth2-client` : 소셜 로그인 등 클라이언트 입장에서 소셜 기능 구현 시 필요한 의존성.
- `@EnableWebSecurity` : Spring Security 설정을 활성화.
- `authorizeRequests` : URL별 권한 관리를 설정하는 옵션의 시작점.
- `antMatches` : 권한 관리 대상 지정 옵션. URL, HTTP 메소드별로 관리 가능.
- `anyRequest` : 설정된 값을 이외 나머지 URL
- 같은 코드가 반복되는 것은 유지보수성 측면에서 좋지 못하므로, 메소드 인자로 세션값을 바로 받아 같은 코드가 반복되는 일을 막는다.
- `@Target(ElementType.PARAMETER)` : 이 어노테이션이 생성될 수 있는 위치 지정.
- `@interface` : 이 파일을 어노테이션 클래스로 지정.
- 스프링 시큐리티에서는 하위 필드를 명시할 수 없다.
- `@WithMockUser(roles="USER")`
  - 인증된 모의 사용자를 만들어서 사용.
  - roles 에 권한 추가 가능.
  - ROLE_USER 권한을 가진 사용자가 API를 요청하는 것과 동일한 효과.
